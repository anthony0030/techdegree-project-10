<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Awesome Startup - Employee Directory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  </head>
  <body>
    <headder></headder>
    <main>
      <div class="top__search">
        <h1 class="main__title uppercase">Awesome Startup Employee Directory</h1>
        <form class="search__form">
          <input id="search__question" type="text" placeholder="Search" class="search__box">
          <button id="search__button" class="search__button"></button>
        </form>
      </div>
      <div id="users" class="container"></div>
      <div id="user-modals"><span id="previous-user"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"/>
    <path d="M0-.5h24v24H0z" fill="none"/>
</svg></span><span id="next-user"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"/>
    <path d="M0-.25h24v24H0z" fill="none"/>
</svg></span></div>
    </main>
    <footer></footer>
    <script>//converts date format from "2014-12-11 14:35:49" into 11/12/14
function dateConverter(date){ 
  const splitDate = date.split("-");
  const year = splitDate[0].substring(2);
  const month = splitDate[1];
  const splitDay = splitDate[2].split(" ");
  const day = splitDay[0];
  return day + "/" + month + "/" + year;
}

function toTitleCase(str){
  return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}
function convertStateRegion(input, to) {

  if (to === undefined) {
    if (input.length > 2) {
      to = "TO_ABBREVIATED";
    } else {
      to = "TO_NAME";
    }
  }

  var states = [
    ['Alabama', 'AL'],
    ['Alaska', 'AK'],
    ['American Samoa', 'AS'],
    ['Arizona', 'AZ'],
    ['Arkansas', 'AR'],
    ['Armed Forces Americas', 'AA'],
    ['Armed Forces Europe', 'AE'],
    ['Armed Forces Pacific', 'AP'],
    ['California', 'CA'],
    ['Colorado', 'CO'],
    ['Connecticut', 'CT'],
    ['Delaware', 'DE'],
    ['District Of Columbia', 'DC'],
    ['Florida', 'FL'],
    ['Georgia', 'GA'],
    ['Guam', 'GU'],
    ['Hawaii', 'HI'],
    ['Idaho', 'ID'],
    ['Illinois', 'IL'],
    ['Indiana', 'IN'],
    ['Iowa', 'IA'],
    ['Kansas', 'KS'],
    ['Kentucky', 'KY'],
    ['Louisiana', 'LA'],
    ['Maine', 'ME'],
    ['Marshall Islands', 'MH'],
    ['Maryland', 'MD'],
    ['Massachusetts', 'MA'],
    ['Michigan', 'MI'],
    ['Minnesota', 'MN'],
    ['Mississippi', 'MS'],
    ['Missouri', 'MO'],
    ['Montana', 'MT'],
    ['Nebraska', 'NE'],
    ['Nevada', 'NV'],
    ['New Hampshire', 'NH'],
    ['New Jersey', 'NJ'],
    ['New Mexico', 'NM'],
    ['New York', 'NY'],
    ['North Carolina', 'NC'],
    ['North Dakota', 'ND'],
    ['Northern Mariana Islands', 'NP'],
    ['Ohio', 'OH'],
    ['Oklahoma', 'OK'],
    ['Oregon', 'OR'],
    ['Pennsylvania', 'PA'],
    ['Puerto Rico', 'PR'],
    ['Rhode Island', 'RI'],
    ['South Carolina', 'SC'],
    ['South Dakota', 'SD'],
    ['Tennessee', 'TN'],
    ['Texas', 'TX'],
    ['US Virgin Islands', 'VI'],
    ['Utah', 'UT'],
    ['Vermont', 'VT'],
    ['Virginia', 'VA'],
    ['Washington', 'WA'],
    ['West Virginia', 'WV'],
    ['Wisconsin', 'WI'],
    ['Wyoming', 'WY']
  ];

  // So happy that Canada and the US have distinct abbreviations
  var provinces = [
    ['Alberta', 'AB'],
    ['British Columbia', 'BC'],
    ['Manitoba', 'MB'],
    ['New Brunswick', 'NB'],
    ['Newfoundland', 'NF'],
    ['Northwest Territory', 'NT'],
    ['Nova Scotia', 'NS'],
    ['Nunavut', 'NU'],
    ['Ontario', 'ON'],
    ['Prince Edward Island', 'PE'],
    ['Quebec', 'QC'],
    ['Saskatchewan', 'SK'],
    ['Yukon', 'YT']
  ];

  var regions = states.concat(provinces);

  var i; // Reusable loop variable
  if (to === "TO_ABBREVIATED") {
    input = input.replace(/\w\S*/g, function(txt) {
      return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    });
    for (i = 0; i < regions.length; i++) {
      if (regions[i][0] == input) {
        return (regions[i][1]);
      }
    }
  } else if (to === "TO_NAME") {
    input = input.toUpperCase();
    for (i = 0; i < regions.length; i++) {
      if (regions[i][1] == input) {
        return (regions[i][0]);
      }
    }
  }
}// $( document ).ready(function() {

const usersToMake = 12;
const userNationalities = "US,CA";

const searchButton = document.getElementById("search__button");
const searchQuestion = document.getElementById("search__question");
const modalContainer = document.getElementById("user-modals");
const userContainer = document.getElementById("users");
var users = $(".user-pain__window");
var userModals = $(".user-modal");
var showUsers = [];
const usersNames = [];
const usersUsernames = [];

const nextUser = document.getElementById("next-user");
const previousUser = document.getElementById("previous-user");

var currentVisibleUser;
var previusActiveUser;
var firstActiveUser;
var nextActiveUser;
var lastActiveUser;

function printUser(data, index){
  // console.log(data);
  // console.log(data.gender);
  const avatarSrc = data.picture.large;
  const nameText = data.name.first + " " + data.name.last;
  const emailText = data.email;
  const placeText = toTitleCase(data.location.state);
  const usernameText = data.login.username;

  const user = document.createElement("DIV");
  user.classList.add("user-pain__window");

  const photo = document.createElement("DIV");
  photo.classList.add("user-pain__photo");
  user.appendChild(photo);

  const avatar = document.createElement("IMG");
  avatar.classList.add("user-pain__avatar");
  avatar.src = avatarSrc;
  photo.appendChild(avatar);

  const details = document.createElement("DIV");
  details.classList.add("user-pain__details");
  user.appendChild(details);

  const name = document.createElement("H2");
  name.classList.add("user-pain__title");
  name.classList.add("capitalize");
  name.appendChild(document.createTextNode(nameText));
  details.appendChild(name);

  const email = document.createElement("P");
  email.classList.add("user-pain__email");
  email.appendChild(document.createTextNode(emailText));
  details.appendChild(email);

  const place = document.createElement("P");
  place.classList.add("user-pain__place");
  place.appendChild(document.createTextNode(placeText));
  details.appendChild(place);

  userContainer.appendChild(user);
  usersNames.push(nameText);
  usersUsernames.push(usernameText);
  showUsers.push(true);
} // end of printUser


function printUserModal(data, index){
  // console.log(data)
  // console.log(data.gender)
  const closeText = "Ã—";
  const avatarSrc = data.picture.large;
  const nameText = data.name.first + " " + data.name.last;
  const emailText = data.email;
  const placeText = toTitleCase(data.location.state);
  const stateText = convertStateRegion(data.location.state);
  const phoneText = data.cell;
  const streetText = toTitleCase(data.location.street);
  const cityText = toTitleCase(data.location.city);
  const posteCode = data.location.postcode;
  const addressText = streetText+", "+cityText+" "+stateText+" "+posteCode;
  const bdayText = "Birthday: " + dateConverter(data.dob);

  const modal = document.createElement("DIV");
  modal.classList.add("user-modal");

  const close = document.createElement("SPAN");
  close.classList.add("close");
  close.appendChild(document.createTextNode(closeText));
  modal.appendChild(close);

  const avatar = document.createElement("IMG");
  avatar.classList.add("user-modal__avatar");
  avatar.src = avatarSrc;
  modal.appendChild(avatar);

  const name = document.createElement("H2");
  name.classList.add("user-modal__name");
  name.classList.add("capitalize");
  name.appendChild(document.createTextNode(nameText));
  modal.appendChild(name);

  const email = document.createElement("P");
  email.classList.add("user-modal__email");
  email.appendChild(document.createTextNode(emailText));
  modal.appendChild(email);

  const place = document.createElement("P");
  place.classList.add("user-modal__place");
  place.appendChild(document.createTextNode(placeText));
  modal.appendChild(place);

  const hr = document.createElement("HR");
  modal.appendChild(hr);

  const phone = document.createElement("P");
  phone.classList.add("user-modal__phone");
  phone.appendChild(document.createTextNode(phoneText));
  modal.appendChild(phone);

  const address = document.createElement("P");
  address.classList.add("user-modal__address");
  address.appendChild(document.createTextNode(addressText));
  modal.appendChild(address);

  const bday = document.createElement("P");
  bday.classList.add("user-modal__bday");
  bday.appendChild(document.createTextNode(bdayText));
  modal.appendChild(bday);

  modalContainer.appendChild(modal);

} // end of printUserModal

function hideAllUserModals(){
  modalContainer.style.display = "none";
  $.each(userModals, function(index, value) {
    userModals[index].style.display = "none";
  });
  currentVisibleUser= -1;
}


function activateUsers(){
  userModals = $(".user-modal");
  users = $(".user-pain__window");
  $.each(users, function(index, value) {
    value.addEventListener("click", function(event){
      modalContainer.style.display = "block";
      userModals[index].style.display = "block";
      currentVisibleUser = index;
      // console.log("i am user number: " + index);
    });
  });
}


function calcActiveUsers(){

  firstActiveUser = usersToMake-1;
  previusActiveUser = 0;
  nextActiveUser = -1;
  lastActiveUser = usersToMake-1;
  previusActiveUser = currentVisibleUser;


  for(var i=0; i<=usersToMake; i++){
    if(showUsers[i]){
      if(i < currentVisibleUser){previusActiveUser = i;}
      if(firstActiveUser >= i){firstActiveUser = i;}
      if(nextActiveUser<=currentVisibleUser){nextActiveUser = i;}
      lastActiveUser = i;
    }
  } // end of for loop

  // console.log("-----------------------------------")
  // console.log("firstActiveUser: " + firstActiveUser)
  // console.log("previusActiveUser: " + previusActiveUser)
  // console.log("currentVisibleUser: " + currentVisibleUser)
  // console.log("nextActiveUser: " + nextActiveUser)
  // console.log("lastActiveUser: " + lastActiveUser)
  // console.log("-----------------------------------")
} // end of calcActiveUsers()


function goToPreviousUser(){
  if(currentVisibleUser >= 0){
    calcActiveUsers();
    // console.log("prev user RUN")
    if(currentVisibleUser > firstActiveUser){
      userModals[currentVisibleUser].style.display= "none";
      userModals[previusActiveUser].style.display= "block";
      currentVisibleUser = previusActiveUser;
    } else {
      userModals[currentVisibleUser].style.display= "none";
      userModals[lastActiveUser].style.display= "block";
      currentVisibleUser = lastActiveUser;
    }
  }
}


function goToNextUser(){
  if(currentVisibleUser >= 0){
    calcActiveUsers();
    // console.log("next user RUN")
    if(currentVisibleUser < lastActiveUser){
      userModals[currentVisibleUser].style.display= "none";
      userModals[nextActiveUser].style.display= "block";
      currentVisibleUser= nextActiveUser;
    } else {
      userModals[currentVisibleUser].style.display= "none";
      userModals[firstActiveUser].style.display= "block";
      currentVisibleUser = firstActiveUser;
    }
  }
}


$.ajax({
  url: "https://randomuser.me/api/?results="+usersToMake+"&nat="+userNationalities,
  dataType: "json",
  success: function(data){
    $.each(data.results, function( index, value ){
      printUserModal(data.results[index],index);
      printUser(data.results[index],index);
    });
    activateUsers();
    // console.log(data);
  }
});


function fliterUsers(){
  var usersToShow = users;
  userContainer.innerHTML = "";
  for (var i = 0; i < usersToMake; i++) {
    if(usersUsernames[i].includes(searchQuestion.value) || usersNames[i].includes(searchQuestion.value) || searchQuestion.value.trim() === ""){
     showUsers[i] = true;
     userContainer.appendChild(usersToShow[i]);
    }
    else{
      showUsers[i] = false;
    }
  }
}


function keyDownTextField(event) {
  event.preventDefault();
  switch (event.keyCode) {


    case 8:
      // alert('backspace');
      goToPreviousUser();
    break;

    case 13:
      // alert('enter');
      goToNextUser();
    break;

    case 27:
      // alert('esc');
      hideAllUserModals();
    break;

    case 32:
      // alert('space');
      goToNextUser();
    break;

    case 37:
      // alert('left');
      goToPreviousUser();
    break;

    case 38:
      // alert('up');
      goToNextUser();
    break;

    case 39:
      // alert('right');
      goToNextUser();
    break;

    case 40:
      // alert('down');
      goToPreviousUser();
    break;

    case 65:
      // alert('a');
      goToPreviousUser();
    break;

    case 68:
      // alert('d');
      goToNextUser();
    break;

    case 83:
      // alert('s');
      goToPreviousUser();
    break;

    case 87:
      // alert('w');
      goToNextUser();
    break;

    default:
      // alert(String.fromCharCode(event.keyCode)+" was pressed. With keyCode " +event.keyCode);
    break;
  }
}


document.addEventListener("keyup", keyDownTextField, false);
searchQuestion.removeEventListener("keyup", keyDownTextField, true);

modalContainer.addEventListener("click", function(event){
  if(event.target === modalContainer || event.target.className === "close"){
    hideAllUserModals();
  }
});

previousUser.addEventListener("click", function(event){
  goToPreviousUser(event);
});

nextUser.addEventListener("click", function(event){
  goToNextUser(event);
});

searchButton.addEventListener("click", function(event){
  event.preventDefault();
  // console.log("searching for " + searchQuestion.value);
  fliterUsers(searchQuestion.value);
});

searchQuestion.addEventListener("keyup", function(event){
  // console.log("searching for " + searchQuestion.value)
  fliterUsers(searchQuestion.value);
});



// }); // End of document ready
    </script>
  </body>
</html>